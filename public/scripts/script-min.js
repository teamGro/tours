const menuBtn=document.querySelector(".menu-btn"),menuContainer=document.querySelector(".menu");menuBtn.addEventListener("click",function(){this.classList.toggle("menu-btn_open"),this.classList.contains("menu-btn_open")?this.classList.remove("menu-btn_close"):this.classList.add("menu-btn_close"),menuContainer.classList.toggle("menu_open")});const countriesField=document.querySelector(".search__field_country");let countriesFieldName=document.querySelector(".search__title_country");countriesField.addEventListener("click",function(e){let t=e.target;if(t.closest(".search__field-wrap")){if(null==this.querySelector(".menu__list")){let e=renderCountriesList(countries,{main:"menu__list countries menu__list_disactive",sub:"countries__places countries__places_disactive"},{main:"menu__item",sub:"places",allTours:"places_all"});return this.append(e),this.querySelector(".search__more").classList.add("search__more_open"),void this.querySelector(".menu__list").classList.toggle("menu__list_disactive")}return this.querySelector(".menu__list").classList.toggle("menu__list_disactive"),void this.querySelector(".search__more").classList.toggle("search__more_open")}t.closest(".places")&&(countriesFieldName.textContent=t.textContent,this.querySelector(".countries__places").classList.toggle("countries__places_disactive"),this.querySelector(".search__more").classList.toggle("search__more_open"),this.querySelector(".menu__list").classList.toggle("menu__list_disactive")),t.querySelector(".countries__places").classList.toggle("countries__places_disactive")}),months={0:"Январь",1:"Февраль",2:"Март",3:"Апрель",4:"Май",5:"Июнь",6:"Июль",7:"Август",8:"Сентябрь",9:"Октябрь",10:"Ноябрь",11:"Декабрь"};const templ=document.querySelector("#templ"),dateField=document.querySelector(".search__field_dates");let dateTempl=templ.content.querySelector("#calendar");dateField.addEventListener("click",function(e){let t,n,l,r,s,a=e.target;if(console.log(a),a.closest(".search__field-wrap")&&"BUTTON"!=a.tagName)return null==this.querySelector(".calendar")?(n=(t=new Date).getMonth(),l=t.getFullYear(),(r=dateTempl.querySelector(".calendar__month")).textContent=`${months[n]} ${l}`,s=dateTempl.querySelector(".calendar__container"),console.log(s),createCalendar(s,l,n),this.append(dateTempl),void this.querySelector(".search__more").classList.add("search__more_open")):(this.querySelector(".calendar").classList.toggle("calendar_disactive"),void this.querySelector(".search__more").classList.toggle("search__more_open"));this.querySelector(".calendar__btn_next").addEventListener("click",()=>{let e=new Date,t=e.getMonth();t+=1;let n=e.getFullYear();dateTempl.querySelector(".calendar__month").textContent=`${months[t]} ${n}`;let l=dateField.querySelector(".calendar__container");dateField.querySelector(".calendar__table").remove(),createCalendar(l,n,t)})});const tripField=document.querySelector(".search__field_type");let tripFieldName=document.querySelector(".search__title_type");tripField.addEventListener("click",function(e){let t=e.target;if(console.log(t),t.closest(".search__field-wrap")){if(null==this.querySelector(".menu__list")){let e=renderTripTypes(tripTypes,"menu__list trips","menu__item trip__item");return this.append(e),void this.querySelector(".search__more").classList.add("search__more_open")}return this.querySelector(".menu__list").classList.toggle("menu__list_disactive"),void this.querySelector(".search__more").classList.toggle("search__more_open")}t.closest(".trip__item")&&(this.querySelector(".menu__list").classList.toggle("menu__list_disactive"),this.querySelector(".search__more").classList.toggle("search__more_open"),tripFieldName.textContent=t.textContent)});let toursFilterBtns=document.querySelector(".tours__btn-wrap"),tours=document.querySelector(".offers"),toursOffers=document.querySelectorAll("[data-country]"),toursFilters=document.querySelector(".filters"),toursBtnArrow=document.querySelector(".tours__btn-arrow"),filterItalyBtn=document.querySelector("#italy");filterItalyBtn.addEventListener("click",function(e){filterHandler(this,e)});let filterIslandBtn=document.querySelector("#island");filterIslandBtn.addEventListener("click",function(e){filterHandler(this,e)});let filterTurkeyBtn=document.querySelector("#turkey");filterTurkeyBtn.addEventListener("click",function(e){filterHandler(this,e)});let filterSpainBtn=document.querySelector("#spain");filterSpainBtn.addEventListener("click",function(e){filterHandler(this,e)});let heightHotContainer=document.querySelector(".offers__item"),btnNextSlideHot=document.querySelector(".tours__btn-arrow_hot");btnNextSlideHot.style.top=heightHotContainer.offsetHeight-btnNextSlideHot.offsetHeight/2+"px";let imgHeightPop=document.querySelector(".popular__img"),btnNextSlidePop=document.querySelector(".tours__btn-arrow_pop");btnNextSlidePop.style.top=imgHeightPop.offsetHeight/2-btnNextSlidePop.offsetHeight/2+"px";let dataPatterns={name:/^[а-яa-z0-9_-\S]{3,16}$/i,phone:/^((\+?7|8)[ \-]?)?((\(\d{3}\))|(\d{3}))?([ \-])?(\d{3}[\- ]?\d{2}[\- ]?\d{2})$/,country:/^[а-яa-z0-9_-\S]{5,30}$/i},userName=document.querySelector("#user-name");userName.value=localStorage.getItem("user-name")||"",userName.addEventListener("blur",function(){onBlurHandle(this,"form__invalid","name")}),userName.addEventListener("focus",function(){onFocusHandle(this,"form__invalid")});let userWishes=document.querySelector("#user-wishes");userWishes.value=localStorage.getItem("user-country")||"",userWishes.addEventListener("blur",function(){onBlurHandle(this,"form__invalid","country")}),userWishes.addEventListener("focus",function(){onFocusHandle(this,"form__invalid")});let userTel=document.querySelector("#user-tel");userTel.value=localStorage.getItem("user-tel")||"",userTel.addEventListener("blur",function(){""!==this.value.trim()&&(dataPatterns.phone.test(this.value)?localStorage.setItem("user-tel",this.value):this.classList.add("form__invalid"))}),userTel.addEventListener("focus",function(){onFocusHandle(this,"form__invalid")});let connections=document.querySelector(".form__connection");connections.addEventListener("click",function(e){let t=e.target;"SPAN"==t.tagName&&t.classList.contains("chk__input")&&t.classList.toggle("chk__input_active"),"LABEL"===t.tagName&&t.classList.contains("chk__label")&&t.parentNode.querySelector(".chk__input").classList.toggle("chk__input_active")});let contacts=document.querySelector(".form__contact");contacts.addEventListener("click",function(e){let t=e.target;"SPAN"==t.tagName&&t.classList.contains("chk__input")&&t.classList.toggle("chk__input_active"),"LABEL"===t.tagName&&t.classList.contains("chk__label")&&t.parentNode.querySelector(".chk__input").classList.toggle("chk__input_active")});let agreementsSubscibe=document.querySelector(".agreements__input_subscribe");agreementsSubscibe.addEventListener("click",function(){this.classList.toggle("agreements__input_active")});let agreementsHandle=document.querySelector(".agreements__input_handle"),popupContainer=templ.content.querySelector(".popup"),overlay=document.querySelector(".overlay");agreementsHandle.addEventListener("click",function(){if(this.classList.toggle("agreements__input_active"),this.classList.contains("agreements__input_active")){let e;document.body.style.overflow="hidden",overlay.classList.add("overlay_active"),overlay.style.top=window.pageYOffset+"px",overlay.children.length||(e=popupContainer.cloneNode(!0),overlay.append(e)),overlay.querySelector(".popup__btn_agree").addEventListener("click",()=>{document.body.style.overflow="",overlay.classList.remove("overlay_active")}),overlay.querySelector(".popup__btn_disagree").addEventListener("click",()=>{document.body.style.overflow="",this.classList.remove("agreements__input_active"),overlay.classList.remove("overlay_active")}),overlay.querySelector(".popup__close-btn").addEventListener("click",()=>{document.body.style.overflow="",this.classList.remove("agreements__input_active"),overlay.classList.remove("overlay_active")})}});let btnSend=document.querySelector(".btn-send");btnSend.addEventListener("click",function(e){e.preventDefault();agreementsHandle.classList.contains("agreements__input_active")||(0,agreementsHandle.classList.add("agreements__input_handle-invalid")),""===userWishes.value.trim()&&(0,userWishes.classList.add("form__invalid")),""===userName.value.trim()&&(0,userName.classList.add("form__invalid"))}),new Glide(".glide2",{bound:!0,startAt:0,breakpoints:{2000:{perView:2},1023:{perView:3},767:{perView:2}}}).mount(),new Glide(".glide",{}).mount();let canvasTopElem=document.querySelector(".footer__item-line_top"),canvasBottomElem=document.querySelector(".footer__item-line_bottom");if(canvasTopElem.getContext){let e=canvasTopElem.getContext("2d");e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=5,e.beginPath(),e.moveTo(0,0),e.lineTo(54.5,74),e.lineTo(5e3,74),e.stroke();let t=canvasBottomElem.getContext("2d");t.strokeStyle="rgb(255, 255, 255)",t.lineWidth=5,t.beginPath(),t.moveTo(0,80),t.lineTo(54.5,3),t.lineTo(5e3,3),t.stroke()}function filterHandler(e,t){let n=t.target.id;if(e.classList.contains("tours__btn_active")){if(e.classList.remove("tours__btn_active"),null!=e.parentNode.querySelector(".tours__btn_active"))return void Array.from(toursFilters.querySelectorAll(`[data-country=${n}]`)).forEach(e=>{e.parentNode.removeChild(e)});for(tours.style.display="flex",toursBtnArrow.style.display="block";toursFilters.firstChild;)toursFilters.removeChild(toursFilters.firstChild);return}let l=document.createDocumentFragment();Array.from(toursOffers).forEach(e=>{if(e.getAttribute("data-country")==n){let t=e.cloneNode(!0);l.append(t)}}),toursFilters.append(l),toursFilters.style.display="flex",tours.style.display="none",toursBtnArrow.style.display="none",e.classList.add("tours__btn_active")}function onBlurHandle(e,t,n){dataPatterns[n].test(e.value)?localStorage.setItem(`user-${n}`,e.value):e.classList.add(t)}function onFocusHandle(e,t){e.classList.contains(t)&&e.classList.remove(t)}let countries={"Южная Америка":[{name:"Аргентина",link:"#"},{name:"Бразилия",link:"#"},{name:"Перу",link:"#"},{name:"Уругвай",link:"#"},{name:"все туры на континенте",link:"#"}],"Арктика и Антарктика":[{name:"Арктика",link:"#"},{name:"Антарктика",link:"#"},{name:"все туры на континенте",link:"#"}],"Северная Америка":[{name:"США",link:"#"},{name:"Мексика",link:"#"},{name:"Канада",link:"#"},{name:"все туры на континенте",link:"#"}],"Африка":[{name:"Египет",link:"#"},{name:"Нигерия",link:"#"},{name:"все туры на континенте",link:"#"}],"Австралия и Океания":[{name:"Австралия",link:"#"},{name:"Океания",link:"#"},{name:"все туры на континенте",link:"#"}],"Европа":[{name:"Франция",link:"#"},{name:"Германия",link:"#"},{name:"Италия",link:"#"},{name:"все туры на континенте",link:"#"}],"Россия":[{name:"Москва",link:"#"},{name:"Санкт-Петербург",link:"#"},{name:"все туры на континенте",link:"#"}],"Азия":[{name:"Китай",link:"#"},{name:"Япония",link:"#"},{name:"все туры на континенте",link:"#"}]};function renderCountriesList(e,t,n){let l=document.createElement("ul");l.className=t.main;let r=new DocumentFragment;for(let l in e){let s=document.createElement("li");s.className=n.main,s.textContent=l;let a=document.createElement("ul"),o=new DocumentFragment;a.className=t.sub,e[l].forEach((t,r)=>{let s=document.createElement("li"),a=document.createElement("a");a.textContent=t.name,a.href=t.link,r==e[l].length-1?s.className=n.allTours:s.className=n.sub,s.append(a),o.append(s)}),a.append(o),s.append(a),r.append(s)}return l.append(r),l}function getNextMonth(e,t){let n=new Date,l=n.getMonth();l+=1;let r=n.getFullYear();t.querySelector(".calendar__month").textContent=`${months[l]} ${r}`;let s=t.querySelector(".calendar__container");t.querySelector(".calendar__table").remove(),e(s,r,l)}function createCalendar(e,t,n){let l=new Date(t,n),r='<table class="calendar__table"><tr><th>Пн</th><th>Вт</th><th>Ср</th><th>Чт</th><th>Пт</th><th>Сб</th><th>Вс</th></tr><tr>';for(let e=0;e<getDay(l);e++)r+="<td></td>";for(;l.getMonth()==n;)r+=`<td>${l.getDate()}</td>`,getDay(l)%7==6&&(r+="</tr><tr>"),l.setDate(l.getDate()+1);if(0!=getDay(l))for(let e=getDay(l);e<7;e++)r+="<td></td>";r+="</tr></table>",e.innerHTML=r}function getDay(e){let t=e.getDay();return 0==t&&(t=7),t-1}let tripTypes=["Активный","Майские","На авто","На корабле","Новый год","Поход","Серфинг","Эксклюзив","Экскурсионный","Экспедиция"];function renderTripTypes(e,t,n){let l=document.createElement("ul");l.className=t;let r=new DocumentFragment;return e.forEach(e=>{let t=document.createElement("li"),l=document.createElement("span");l.textContent=e,t.className=n,t.append(l),r.append(t)}),l.append(r),l}